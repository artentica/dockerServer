version: '3'

services:
    mariadb:
        container_name: mariadb
        image: mariadb:latest
        restart: always
        environment:
            - MYSQL_DATABASE=${MARIA_DB}
            - MYSQL_USER=${MARIA_USER}
            - MYSQL_PASSWORD=${MARIA_PASSWORD}
            - MYSQL_ROOT_PASSWORD=${MARIA_ROOT_PASSWORD}
        expose:
            - "3306"
        volumes:
            - /srv/mariadb:/var/lib/mysql

    nextcloud:
        container_name: nextcloud
        image: nextcloud:latest
        restart: always
        expose:
            - "80"
        volumes:
            - /srv/nextcloud:/var/www/html
        links:
            - mariadb
        depends_on:
            - mariadb

    deluge:
        container_name: deluge
        image: linuxserver/deluge:latest
        restart: always
        environment:
            - PUID=0
            - PGID=0
        volumes:
            - /srv/deluge/downloads:/downloads
            - /srv/deluge/config:/config
            - /etc/localtime:/etc/localtime:ro
        links: 
            - portainer
        expose:
            - "8112"
            - "58846"
        ports:
            - "7000-7009:7000-7009"
 

    sonarr:
        container_name: sonarr
        image: linuxserver/sonarr
        restart: always
        ports:
          - 8989:8989
        volumes:
          # In order to the container uses the same date which is in the host, it is necessary to share /etc/localtime file
          - /etc/localtime:/etc/localtime:ro
          - /dev/rtc:/dev/rtc:ro
          - /srv/sonarr/config:/config
          - /srv/deluge/downloads:/downloads
          - /srv/tvshow:/tv
        links:
            - deluge
        depends_on:
            - deluge

    radarr:
        container_name: radarr
        image: linuxserver/radarr
        restart: always
        expose:
            - "7878"
        ports:
            - "7878:7878"
        environment:
            - PUID=1000
            - PGID=1000
        volumes:
            - /srv/deluge/downloads:/downloads:rw
            - /srv/radarr/config:/config:rw
            - /srv/movie:/movies
            - /etc/localtime:/etc/localtime:ro
        links:
            - deluge

        depends_on:
            - deluge

    jackett:
       container_name: jackett
       image: linuxserver/jackett:latest
       restart: always
       environment:
           - PGID=1000
           - PUID=1000
           - TZ=Europe/London
       volumes:
           - /srv/jackett/config:/config
           - /srv/jackett/downloads:/downloads
       ports:
         - "9117:9117"
        
    emby:
        container_name: emby
        image: emby/embyserver
        restart: always
        ports:
            - 8096:8096
        volumes:
            - /etc/localtime:/etc/localtime:ro
            - /srv/emby/config:/config
            - /srv/tvshow:/media/tvshow
            - /srv/movie:/media/movie
        environment:
            - VIRTUAL_PORT=8096
            - VIRTUAL_HOST=emby.htpc
            - AUTO_UPDATES_ON=true
            - APP_UID=1000
            - APP_GID=1000

    filebrowser:
        container_name: filebrowser
        image: hacdias/filemanager:latest
        volumes:
          - /srv/filebrowser/config.json:/config.json
          - /srv:/srv
          - /srv/filebrowser/database.db:/etc/database.db
        expose:
          - 80


    caddy:
        container_name: caddy
        build: ../caddy
        image: caddy
        volumes:
            - /srv/caddy:/root/.caddy
            - /srv/www/:/var/www/html
        links:
            - nextcloud
            - radarr
            - deluge
            - sonarr
            - filebrowser
            - emby

        depends_on:
            - nextcloud
            - sonarr
            - radarr
            - deluge
            - filebrowser
            - emby
        ports:
            - "80:80"
            - "443:443"


    portainer:
        container_name: "portainer"
        image: portainer/portainer
        restart: always
        volumes:
            - /var/run/docker.sock:/var/run/docker.sock
            - /srv/portainer/data:/data
